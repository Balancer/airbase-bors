<b>Общая репутация:</b> {$reputation_abs_value}.<br />
<b>Положительных голосов:</b> {$plus}<br />
<b>Негативных голосов:</b> {$minus}<br />

<p><i><b>Внимание!</b>
Репутацию может выставить только участник, имеющий более 50 сообщений на форуме.
 <small>Страница обновляется один раз в сутки, либо при изменении репутации. Длина сообщения ограничена 500-ми символами.</small>
</i>
</p>

{if not $me or $me->is_banned()}
<p style="color:red"><b>Вы не можете изменять репутацию пользователей, поскольку не авторизованы или Вам запрещено общаться на форуме.</b><p>
{else}
<table width="100%"><tr>
<td width="90%">
<form method="post" action="{$this->url()}?act=reputation_add_do" name="rep">
<div style="background-color: #cfc;"><input type="radio" id="s1" name="score" value="+1">&nbsp;увеличить репутацию</div>
<div style="background-color: #fcc;"><input type="radio" id="s2" name="score" value="-1">&nbsp;уменьшить репутацию</div>
<textarea name="comment" style="width: 98%;" rows="5"></textarea><br />
Ссылка (опционально):&nbsp;<input name="uri" value="11" style="width: 60%;"><br />
<input type="hidden" name="user_id" value="{$user_id}">
<input type="submit" value="Отправить" onClick="{literal}if(!getElementById('s1').checked && !getElementById('s2').checked){ alert('Выберите оценку!'); return false;} else return true;{/literal}">
</form>
</td>
<td>
{bors_class_load var=owner class="forum_user" id=$user_id}
<div class="avatar_block">{include file="xfile:templates/forum/post-avatar.html"}</div>
</td>
</tr></table>
{/if}

<script>document.forms['rep'].elements['uri'].value = document.location.search.substring(1) ? document.location.search.substring(1) : document.referrer </script>

{if $list}
{$this->pages_links_nul()}

<table cellSpacing="0" class="btab">
<tr><th>Дата</th><th>Вид</th><th>От кого</th><th>Комментарий</th></tr>
{foreach from=$list item=r}
{bors_object_load var=u class="forum_user" id=$r->voter_id()}

{if $r->score()>0}
{assign var="backcolor" value="pos_reputation"}
{else}
{assign var="backcolor" value="neg_reputation"}
{/if}
<tr>
	<td class="{$backcolor}">{$r->create_time()|full_time}</td>
	<td class="{$backcolor}">{if $r->score() > 0}+{/if}{$r->score()}</td>
	<td class="{$backcolor}">
		<a href="http://balancer.ru/user/{$r->voter_id()}/">{$u->title()}</a><br />
		<a href="http://balancer.ru/user/{$r->voter_id()}/reputation/"><img src="http://balancer.ru/user/{$r->voter_id()}/rep.gif" width="100" height="16" /></a></td> 
	<td class="{$backcolor}">{$r->comment()|truncate:500|pun_lcml}{if $r->refer()}
		<div style="font-size: 6pt; border-top: 1px dotted #888; color: #888;">// За:
			{assign var="obj" value=0}
			{if $r->refer()|regex_match:"^post://(\d+)"}
				{assign var="post_id" value=$r->refer()|regex_replace:"!^post://(\d+).*!":"\\1"}
				{bors_object_load var="obj" class="forum_post" id=$post_id}
			{/if}
			{if $r->refer()|regex_match:"^topic://(\d+)"}
				{assign var="topic_id" value=$r->refer()|regex_replace:"!^topic://(\d+).*!":"\\1"}
				{bors_object_load var="obj" class="forum_topic" id=$topic_id}
			{/if}
			{if $obj}
				<a href="{$obj->url()}">{$obj->title()}</a>
			{else}
				<a href="{$r->refer()}">{$r->refer()}</a>
			{/if}
		</div>{/if}
	</td>
</tr>
{/foreach}
</table>

{$this->pages_links_nul()}
{/if}
